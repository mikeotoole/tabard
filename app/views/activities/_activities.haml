- activities.each do |activity|
  - if activity.is_a? Comment
    - if user_signed_in? and current_user.in_community(activity.community).can? :show, activity
      = render "activities/comment", :comment => activity
    - elsif not current_community
      %li{ :class => 'comment', :created_at => activity.created_at }
        Posted a
        %strong comment
        in
        %strong= link_to activity.community_name, root_url(:subdomain => activity.community_subdomain)
        —
        %time= "#{time_ago_in_words(activity.created_at)} ago"
  - else
    - partial_name = activity.target_type.gsub(/(.)([A-Z])/,'\1_\2').downcase
    %li{ :class => "activity #{partial_name} #{activity.action} #{(user_signed_in? and activity.user_profile == current_user.user_profile ? 'owned' : '')}", :created_at => activity.created_at }
      = link_to activity.user_profile_display_name, user_profile_url(activity.user_profile)
      = render "activities/#{partial_name}", :activity => activity
      —
      %time= "#{time_ago_in_words(activity.created_at)} ago"