= form_for [:management, @role] do |f|

  %p.field
    = f.label :name
    = f.text_field :name
  
  - if @role.id #HACK
      
    %p.field
      = f.label :default_role, "Set as default?"
      = f.check_box :default_role
      
    %h2 Permissions
    %table
      %thead
        %tr
          %th Resource
          %th.view View
          %th.create Create
          %th.edit Edit
          %th.delete Delete
      %tbody
        = f.fields_for :permissions, @role.permissions do |p|
          = p.hidden_field :permissionable_id
          = p.hidden_field :permissionable_type
          = p.hidden_field :name
          %tr
            %td= p.object.permissionable_name
            %td.view= p.check_box(:show_p)
            %td.create= p.check_box(:create_p)
            %td.update= p.check_box(:update_p)
            %td.delete= p.check_box(:delete_p)
      %tfoot
        %tr
          %td{ :colspan => 5 }
            = link_to "New Permission", new_management_role_permission_path(@role), :class => 'button'
    
    %h2 Users
    - if @users.size > 0
      %ul#usercheckboxes
        - for user in @users
          %li
            = label_tag dom_id(user), (check_box_tag 'role[user_ids][]', user.id, @role.user_ids.include?(user.id), :id => dom_id(user)) + ' ' + user.name, :class => "check_box_label"
    - else
      %p No users

  %p
    %button{ :type => 'submit' } Save Changes