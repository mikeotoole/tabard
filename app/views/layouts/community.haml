!!!
%html

  %head
    %title= yield_for(:title, "#{@community.name} - Crumblin")
    = stylesheet_link_tag "subdomains/community"
    = yield :controller_css
    = javascript_include_tag "application"
    = csrf_meta_tags

  %body
    = render 'layouts/bar_' + (user_signed_in? ? 'in' : 'out')
    = render 'layouts/flash_messages'

    #content
      #header
        .title
          %strong= @community.name
          %cite= @community.slogan
        .menu
          %li
            = link_to 'Dashboard', actual_community_url(@community)
          - if can? :index, PageSpace
            %li
              = link_to 'Wiki', page_spaces_path
              - if @community.page_spaces.size > 0
                %ul
                  - @community.page_spaces.each do |space|
                    %li= link_to space.name, space
          - if can? :index, DiscussionSpace
            %li
              = link_to 'Discussions', discussion_spaces_path
              - if @community.discussion_spaces.size > 0
                %ul
                  - @community.discussion_spaces.each do |space|
                    %li= link_to space.name, space
          %li
            -#TODO Doug - Hookup link
            = link_to 'Announcements', '#'
            - if @community.announcement_spaces.size
              %ul
                -#TODO Doug - Double check this after BVR-290 is complete
                - @community.announcement_spaces.each do |space|
                  %li= link_to (space.game ? space.game.name : space.name), space
          - if user_signed_in? and current_user.is_member? @community and @community.custom_forms.size > 0 and can? :index, CustomForm
            %li
              = link_to 'Forms', custom_forms_path
          - if can? :index, RosterAssignment
            %li
              = link_to 'Members', roster_assignments_path
          - if user_signed_in? and current_user.communities.include?(current_community)
            - if management_navigation_items.size > 0
              %li{ :class => 'special settings' }
                = link_to 'Manage', '#'
                %ul
                  - management_navigation_items.each do |item|
                    %li= link_to item[:title], item[:link], (item[:meta] and item[:meta] > 0 ? { :meta => item[:meta] } : {})
          - else
            %li{ :class => 'special signup' }
              - if current_community.can_receive_application_from? current_user
                = link_to 'Apply Now', new_community_application_path
              - elsif user_signed_in? and current_user.application_pending? current_community
                %a Application Pending

      #body
        = yield

    = render 'layouts/footer'