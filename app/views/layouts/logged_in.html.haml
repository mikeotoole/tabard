<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
%html{:dir => 'ltr', :lang => 'en-US', 'xml:lang' => 'en-US', :xmlns => 'http://www.w3.org/1999/xhtml'}
  %head
    %title Brutal Venom
    = stylesheet_link_tag '/themes/' << current_theme << '/stylesheets/master.css'
    = javascript_include_tag 'jquery-1.5.min.js', 'rails', 'application'
    = csrf_meta_tag
    = include_tiny_mce_if_needed
  %body{ :class => "logged_in #{params[:controller]}_view" }
    #bg
      
      #header
        .container
          .title= link_to 'Brutal Venom', root_path
          .slogan We need a slogan
          .userbox
            - if profile_active?
              %p
                = link_to current_profile.name, current_profile
                = current_profile.description
            =render :partial => "layouts/mailbox_list"
            %p
              =link_to 'Account', edit_user_path(current_user), :class => 'button'
              =link_to 'Logout', logout_path, :class => 'button'
      
      - if flash[:messages] || has_announcements?
        != has_announcements? ? '<form method="post" action="' << announcement_acknowledgement_path << '" data-remote="true" id="announcements">' : '<div id="announcements">'
        %ul.container
          - if has_announcements?
            - current_user.unacknowledged_announcements.each do |announcement|
              %li{ :class => 'announcement_' << announcement.id.to_s }
                = link_to(announcement.path, { :class => 'msg', :title => 'Read the full announcement and comments.' }) do
                  %strong= announcement.title
                  &mdash;
                  = announcement.snippet
                %button{ :type => 'submit', :name => 'id', :value => announcement.id, :title => 'Mark as seen.' } Mark as seen
          - if flash[:messages]
            - flash[:messages].each do |message|
              = render :partial => 'layouts/flash_message', :locals => { :message => message }
        != has_announcements? ? '</form>' : '</div>'
        - flash[:messages] = nil
       
      #menu    
        .container
          %ul
            %li
              = link_to 'Info', '#', { :class => 'main' }
              %ul
                %li= link_to 'Test Page 1', '#'
                %li= link_to 'Test Page 2', '#'
                %li= link_to 'Test Page 3', '#'
            %li
              = link_to 'Events', :events, { :class => 'main' }
            %li
              = link_to 'Resources', page_spaces_path, { :class => 'main' }
              - if dynamic_page_spaces
                %ul
                  - dynamic_page_spaces.each do |page_space| 
                    %li= link_to page_space.name, page_space
            %li
              = link_to 'Discussions', :discussion_spaces, { :class => 'main' }
              - if dynamic_discussions
                %ul
                  - dynamic_discussions.each do |discussion_space| 
                    %li= link_to discussion_space.name, discussion_space
                    
            %li
              = link_to 'Active Profiles', user_profile_path(current_user), { :class => 'main' }
              %ul
                - if profiles
                  - profiles.each do |profile|
                    %li{ :class => profile[:name] + (profile[:is_current] ? ' current' : '') }
                      = link_to( active_profile_url(:id => profile[:profile_id], :type => profile[:type])) do
                        = #image_tag '/images/profiles/' + profile[:profile_type] + '.png', :alt => ''
                        = profile[:name]
            %li.search
              %a.main
                Search
              %form
                %input
                %button{ :type => 'submit' }
                  Search
            %li.locale
              %a.main
                Language
              %ul
                - locales.each do |locale|
                  %li{ :class => locale[:locale] + (locale[:is_current] ? ' current' : '') }
                    = link_to({ :locale => locale[:locale] }) do
                      = image_tag '/images/locales/' + locale[:locale] + '.png', :alt => ''
                      = locale[:language]

      #body
        .container
          = yield

      #footer
        .container
          .menu
            %h3 Brutal Venom
            - if nav_featured_pages
              %ul
                - nav_featured_pages.each do |page| 
                  %li= link_to page.title, [page.page_space, page]
          .menu
            %h3 Resources
            - if dynamic_page_spaces
              %ul
                - dynamic_page_spaces.each do |page_space| 
                  %li= link_to page_space.name, page_space
          .menu
            %h3 Members
            %ul
              %li= link_to 'Events', :events
              %li= link_to 'Discussions', :discussion_spaces if current_user.can_show("DiscussionSpace")
              %li= link_to 'Newsletter', :newsletters
              %li= link_to 'Donations', '#'
              
          %p.copyright
            = link_to 'Privacy Policy', '#'
            &nbsp;|&nbsp;
            = link_to t('general.terms_of_use'), '#'
            %br/
            &copy; Copyright digitalAugment Inc, 2010.