%p#bcrumb
  = link_to 'Discussion Spaces', discussion_spaces_path
  = link_to @discussion.discussion_space.name, @discussion.discussion_space
  %span= @discussion.name

#page
  %h1= @discussion.name
  
  - if logged_in?
    %p#actions
      - if @discussion.can_user_lock(current_user)
        - if @discussion.has_been_locked
          = link_to 'Unlock', unlock_discussion_path(@discussion), :method => :post, :class => 'unlock', :title => 'Unlock discussion'
        - else
          = link_to 'Lock', lock_discussion_path(@discussion), :method => :post, :class => 'lock', :title => 'Lock discussion'
      - if current_user.can_update(@discussion)
        = link_to 'Edit', edit_discussion_path(@discussion), :class => 'edit', :title => 'Edit discussion'
      - if current_user.can_delete(@discussion)
        = link_to 'Delete', @discussion, :confirm => 'Are you sure?', :method => :delete, :class => 'delete', :title => 'Delete discussion'

  %p#author
    = get_avatar(:standard, @discussion.user_profile)
    %cite
      Posted by
      - if @discussion.charater_posted?
        = link_to @discussion.character.name, @discussion.character
      - else
        = link_to @discussion.user_profile.name, @discussion.user_profile
    %time= distance_of_time_in_words(@discussion.created_at, Time.now) + ' ago'
  
  #discussionbody= @discussion.body
  
  %h2 Comments
  
  #comments
    -if @discussion.comments.size > 0
      %ol
        - @discussion.comments.each do  |comment|
          = render comment
  - if @discussion.has_been_locked
    %h2 This Discussion is Locked!
  - else
    #reply
      %h2 Leave a Comment
      %p= link_to 'New Comment', new_comment_path(:format => :js, :commentable_id => @discussion.id, :commentable_type => @discussion.class, :form_target => '#reply', :comment_target => '#comments'), :remote => true, :class => 'button' if current_user.can_create('Comment')
