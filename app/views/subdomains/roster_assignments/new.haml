%h1 My Roster Assigments
%p
  This page keeps track of which of your characters are members of
  %strong= current_community.name


- if @roster_assignments.any? or @available_characters.any?
  %table
    %thead
      %tr
        %th.cinch
        %th My Characters
        %th.actions
    - if @roster_assignments.any?
      %tbody
        - @roster_assignments.each do |roster_assignment|
          %tr{ roster_assignment.is_pending ? { :class => 'dim' } : {} }
            %td{ :class => 'avatar cinch' }
              = image_tag roster_assignment.character_proxy_avatar_url(:tiny), :class => 'avatar'
            %td.character
              %h3= roster_assignment.character_proxy_name
              = roster_assignment.is_pending ? 'is pending approval to ' : 'is a member of'
              = roster_assignment.supported_game_smart_name
            %td.actions
              %div
                - if  can? :mine, RosterAssignment or can? :delete, roster_assignment
                  = link_to 'Remove', roster_assignment, :confirm => 'Are you sure?', :method => :delete, :class => 'delete', :meta => "Remove #{roster_assignment.character_proxy_name} from the roster"
    %tfoot
      %tr
        %td
        %td
          - if @available_characters.any?
            = simple_form_for @roster_assignment, :wrapper => false do |f|
              .select{ :class => !!f.object.errors.messages[:character_proxy_id] ? 'field_with_errors' : '' }
                = f.input :character_proxy_id, :as => :radio, :label => false, :wrapper => false, :collection => @available_characters.collect{|cp| cp = [raw(image_tag(cp.avatar_url(:icon), :class => 'avatar')) + "#{cp.name} â€” #{cp.game_name}", cp.id]}
              .select{ :class => !!f.object.errors.messages[:supported_game_id] ? 'field_with_errors' : '' }
                = f.input :supported_game_id, :as => :radio, :label => false, :wrapper => false, :collection => current_community.supported_games.collect{|sg| sg = [sg.smart_name, sg.id]}
              %button{ :type => 'submit' } Add character
        %td
- else
  %p
    %strong
      - if current_community.supported_games.any?
        You do not have any characters available to be added to the roster.
        %p
          = link_to 'Add Characters', user_profile_url(current_user.user_profile, :subdomain => false) + '#characters', :class => 'button'
      - else
        This community does not have any supported games, and thus no rosters.
        %p
          - if can? :manage, RosterAssignment
            = link_to 'Add a Game', new_supported_game_url, :class => 'button'