- title "Community Settings | #{@community.name}"

%h1 Community Settings

= simple_form_for @community, :html => {:novalidate => true} do |f|

  %section.left
    %h2 Options
    %fieldset
      %ol
        = f.input :slogan, :input_html => { :maxlength => Community::MAX_SLOGAN_LENGTH }
        = f.input :is_accepting_members, :label => "Accepting new members?"
        = f.input :email_notice_on_application, :label => "Notify me when an application is submitted."
        = f.input :is_public_roster, :as => :boolean, :label => "Make the community roster public."
        = f.input :is_protected_roster, :as => :boolean, :label => "Roster changes require approval."

  %section.right
    %h2 Appearance
    %fieldset
      %ol
        %li.select
          = f.association :theme, :as => :radio, :collection => Theme.all.collect{|theme| theme = [raw(image_tag("themes/thumbnails/#{theme.thumbnail}", :class => 'big', :theme => theme.css)) + ' ' + theme.name, theme.id]}, :wrapper => false
        %li
          %label Custom Background Image
          = image_tag(@community.background_image_url :thumbnail) unless @community.background_image_url == '/assets/application/blank.gif'
          = f.input :background_image_cache, :as => :hidden
          = f.input :background_image, :as => :file, :label => false
        - unless @community.background_image_url == '/assets/application/blank.gif'
          = f.input :remove_background_image, :as => :boolean, :label => 'Remove image'
        = f.input :background_color, :as => :string, :label => 'Optional Background Color', :input_html => { :maxlength => 6 }, :wrapper_html => { :class => 'color' }
        = f.input :title_color, :as => :string, :label => 'Optional Title Text Color', :input_html => { :maxlength => 6 }, :wrapper_html => { :class => 'color' }

  %p.submit
    = f.button :submit, 'Save Changes'

= stylesheet_link_tag "application/colorpicker"
= javascript_include_tag "colorpicker"
%script{ :type => 'text/javascript' }
  :plain
    $(document).ready(function(){
    
      $('label[for="community_theme_id"] + ul input').change(function(){
        theme = $(this).find('+ label img').attr('theme');
        $('head link.theme').attr('href', '/assets/themes/' + theme + '.css');
      });

      $('#community_background_color').closest('.color').each(function(){
        input_bg_color = $('#community_background_color');
        color = '#' + input_bg_color.val();
        input_bg_color.after('<div class="preview"></div>')
        $('body').css({ backgroundColor: color });
    		input_bg_color.next('.preview').css({ background: color });
        input_bg_color.ColorPicker({
        	color: color,
        	onChange: function (hsb, hex, rgb) {
        		$('body').css({ backgroundColor: '#' + hex });
        		input_bg_color.val(hex).next('.preview').css({ background: '#' + hex });
        	}
        });
      });

      $('#community_title_color').closest('.color').each(function(){
        input_title_color = $('#community_title_color');
        color = '#' + input_title_color.val();
        input_title_color.after('<div class="preview"></div>')
        $('#header .title').css({ textShadow: 'none', color: color });
    		input_title_color.next('.preview').css({ background: color });
        input_title_color.ColorPicker({
        	color: color,
        	onChange: function (hsb, hex, rgb) {
            $('#header .title').css({ textShadow: 'none', color: '#' + hex });
        		input_title_color.val(hex).next('.preview').css({ background: '#' + hex });
        	}
        });
      });
    });