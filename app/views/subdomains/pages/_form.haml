!!!
%html

  %head
    = javascript_include_tag "Markdown.Converter","Markdown.Sanitizer","Markdown.Editor"
    = stylesheet_link_tag "markdown"
    
  %body
    = form_for @page do |f|
      -if @page.errors.any?
        #error_explanation
          %h2= "#{pluralize(@page.errors.count, "error")} prohibited this page from being saved:"
          %ul
            - @page.errors.full_messages.each do |msg|
              %li= msg
    
      .field
        = f.label :name
        = f.text_field :name
      .field
        = f.label :markup
        .wmd-panel
          #wmd-button-bar
          = f.text_area :markup, :class => "wmd-input", :id => "wmd-input"
      .field
        = f.label :show_in_navigation
        = f.check_box :show_in_navigation
      .actions
        = f.submit 'Save' 
        
    #wmd-preview{ :class => "wmd-panel" "wmd-preview" }
    
    :javascript         
      (function () {
          var help = function () { alert("Do you need help?"); }
          
          var converter1 = Markdown.getSanitizingConverter();
          var editor1 = new Markdown.Editor(converter1, "", { handler: help });
          
          editor1.hooks.set("insertImageDialog", function (callback) {
            alert("Please click okay to start scanning your brain...");
            setTimeout(function () {
                var prompt = "We have detected that you like cats. Do you want to insert an image of a cat?";
                if (confirm(prompt))
                    callback("http://icanhascheezburger.files.wordpress.com/2007/06/schrodingers-lolcat1.jpg")
                else
                    callback(null);
            }, 2000);
            return true; // tell the editor that we'll take care of getting the image url
          });
          
          editor1.run();
      })();