= form_for(@registration_application) do |application|
  - if @registration_application.errors.any?
    #error_explanation
      %h2
        = pluralize(@registration_application.errors.count, "error")
        prohibited this registration_application from being saved:
      %ul
        - @registration_application.errors.full_messages.each do |msg|
          %li= msg
          
  = application.hidden_field :site_form_id            
  = fields_for :user do |user|
    %p.field
      = user.label :email
      - if @user.errors[:email].any?
        = @user.errors[:email]
      %br/
      = user.text_field :email
    %p.field
      = user.label :password
      - if @user.errors[:password].any?
        = @user.errors[:password]
      %br/
      = user.password_field :password
    %p.field
      = user.label :password_confirmation
      %br/
      = user.password_field :password_confirmation
  = fields_for :user_profile do |profile|
    %p.field
      = profile.label :name
      - if @profile.errors[:name].any?
        = @profile.errors[:name]
      %br/
      = profile.text_field :name
  
  %ul
    - if @wowCharacters
      - @wowCharacters.each do |character|
        - @character = character
        = render(:file => 'wow_characters/_application_form.html.haml', :locals => { :character => @character })
        
    - if @swtorCharacters
      - @swtorCharacters.each do |character|
        - @character = character
        = render(:file => 'swtor_characters/_application_form.html.haml', :locals => { :character => @character })        
      
  #newcharacters
  %ul
    - if @games
      - @games.each do |game|
        = link_to("New #{game.type} Character", new_base_character_path(:format => :js, :game => {:game_id => game.id}), :remote => true)
        
  - if @registration_application.site_form != nil
    - @registration_application.site_form.questions.each do |question|
      = render :partial => question, :locals => {:submission => application, :actual_submission => @registration_application}
  .actions
    = application.submit 'Submit Application' #, :disable_with => 'Please Wait...'
    